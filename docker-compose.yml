services:
  # All-in-one ROS2 workspace with Gazebo, Nav2, and ML dependencies
  btgencobot:
    platform: linux/amd64
    build:
      context: .
      dockerfile: Dockerfile
      platforms:
        - linux/amd64
    container_name: btgencobot
    hostname: btgencobot
    ports:
      - "6080:6080" # noVNC web interface
      - "5901:5901" # VNC server
      - "8765:8765" # Foxglove Bridge
    volumes:
      # Mount only necessary directories instead of entire project
      - ./src:/workspace/src:cached
      - ./robot_description:/workspace/robot_description:cached
      - ./worlds:/workspace/worlds:cached
      - ./models:/workspace/models:cached  # Mount models as volume instead of copying
      # ROS2 build artifacts (use delegated for better performance)
      - ./install:/workspace/install:delegated
      - ./build:/workspace/build:delegated
      - ./log:/workspace/log:delegated
      # Neovim config and data
      - ~/.config/nvim:/root/.config/nvim:ro  # Read-only to prevent accidental changes
      - nvim-data:/root/.local/share/nvim
      - nvim-state:/root/.local/state/nvim
    environment:
      - ROS_DOMAIN_ID=42
      - DISPLAY=:1
      - RMW_IMPLEMENTATION=rmw_cyclonedds_cpp
    stdin_open: true
    tty: true
    command: /bin/bash

# Named volumes for nvim data persistence
volumes:
  nvim-data:
  nvim-state:
